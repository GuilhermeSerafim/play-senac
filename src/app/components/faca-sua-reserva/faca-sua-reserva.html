<form
  class="form-container"
  #facaSuaReservaFormControl="ngForm"
  (ngSubmit)="onSubmit(facaSuaReservaFormControl)"
>
  @if (errorMessage) {
  <div class="error-banner">
    <mat-icon>error</mat-icon>
    {{ errorMessage }}
  </div>
  }

  <mat-form-field appearance="outline" class="full-width form-container__item">
    <mat-label>Selecione a quadra</mat-label>
    <mat-select
      name="quadraSelecionada"
      [(ngModel)]="quadraSelecionada"
      #quadraSelecionadaControl="ngModel"
      required
      (selectionChange)="onQuadraChange()"
      [disabled]="isLoading" 
    >
      @for (quadra of quadras; track quadra.id) {
      <mat-option [value]="quadra">
        {{ quadra.title }} (Capacidade: {{ quadra.capacidade }})
      </mat-option>
      }
    </mat-select>
    @if (quadraSelecionadaControl.touched && quadraSelecionadaControl.hasError('required')) {
    <mat-error> O campo quadra é obrigatório. </mat-error>
    }
  </mat-form-field>

  <br />

  <mat-form-field appearance="outline" class="full-width form-container__item">
    <mat-label>Selecione a data</mat-label>
    <input
      required
      name="dataSelecionada"
      [(ngModel)]="dataSelecionada"
      #dataSelecionadaControl="ngModel"
      matInput
      [matDatepicker]="picker"
      readonly
      [matDatepickerFilter]="filtroDeData"
      [disabled]="!quadraSelecionada || isLoading"
    />
    <mat-datepicker-toggle matIconSuffix [for]="picker" [disabled]="isLoading"></mat-datepicker-toggle>
    <mat-datepicker #picker></mat-datepicker>
    @if (dataSelecionadaControl.hasError('required')) {
    <mat-error> A data é obrigatória. </mat-error>
    }
  </mat-form-field>

  <br />

  <div class="horarios">
    <mat-form-field appearance="outline">
      <mat-label>Início</mat-label>
      <input
        required
        matInput
        [matTimepicker]="pickerInicio"
        [(ngModel)]="horarioInicioSelecionado"
        name="horarioInicioSelecionado"
        #inicioControl="ngModel"
        [disabled]="!dataSelecionada || isLoading"
        matTimepickerMin="06:00"
        matTimepickerMax="23:00"
      />
      <mat-timepicker #pickerInicio />
      <mat-timepicker-toggle [for]="pickerInicio" matSuffix [disabled]="isLoading" />
      @if (inicioControl.hasError('required')) {
      <mat-error>Obrigatório</mat-error>
      }
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Fim</mat-label>
      <input
        required
        matInput
        [matTimepicker]="pickerFim"
        [(ngModel)]="horarioFimSelecionado"
        name="horarioFimSelecionado"
        #fimControl="ngModel"
        [disabled]="!dataSelecionada || isLoading"
        matTimepickerMin="06:00"
        matTimepickerMax="23:00"
      />
      <mat-timepicker #pickerFim />
      <mat-timepicker-toggle [for]="pickerFim" matSuffix [disabled]="isLoading" />
      @if (fimControl.hasError('required')) {
      <mat-error>Obrigatório</mat-error>
      }
    </mat-form-field>
  </div>

  @if (erroDeHorario && horarioInicioSelecionado && horarioFimSelecionado) {
  <div class="error-intervalo-container">
    <mat-icon style="font-size: 16px; height: 16px; width: 16px">error</mat-icon>
    <span>{{ erroDeHorario }}</span>
  </div>
  }

  <br />

  @if ( convidados.length > 0 ) {
  <mat-chip-listbox class="full-width form-container__item">
    @for (convidado of convidados; track $index) {
    <mat-chip color="primary" selected (removed)="removeConvidado(convidado)" [disabled]="isLoading">
      {{ convidado.nome }}
      <mat-icon matChipRemove>cancel</mat-icon>
    </mat-chip>
    }
  </mat-chip-listbox>
  <br />
  }

  <div class="form-container__bottom">
    <button
      type="button"
      (click)="abreDialogConvidado()"
      mat-icon-button
      [disabled]="
        !quadraSelecionada ||
        isLoading ||
        (quadraSelecionada.capacidade && convidados.length >= quadraSelecionada.capacidade - 1)
      "
      aria-label="Adicionar convidado"
      class="btn-person__add"
    >
      <mat-icon>person_add</mat-icon>
    </button>

    <button
      mat-raised-button
      class="enviar-button"
      color="primary"
      type="submit"
      [disabled]="facaSuaReservaFormControl.invalid || erroDeHorario || isLoading"
      [ngStyle]="
        facaSuaReservaFormControl.invalid || erroDeHorario
          ? { backgroundColor: '#9e9e9e', cursor: 'not-allowed', color: '#ffffff' }
          : {}
      "
    >
      @if (isLoading) {
        <mat-spinner diameter="24" color="accent"></mat-spinner>
      } @else {
        Confirmar
      }
    </button>
  </div>
</form>